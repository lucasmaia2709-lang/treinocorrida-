<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ExpliQ - Plataforma Completa</title>
    
    <!-- Fontes e Ícones -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS Nativo -->
    <style>
        :root {
            --primary: #5E5CE6; --dark: #1C1C1E; --bg: #F2F2F7; --input-bg: #F9FAFB;
            --gray: #8E8E93; --green: #34C759; --white: #FFFFFF; --red: #FF3B30; --orange: #FF9500;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--dark); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* Telas */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg); display: none; flex-direction: column; overflow-y: auto; z-index: 10; }
        .screen.active { display: flex; animation: fadeIn 0.3s ease-out; }
        .screen.white-bg { background-color: var(--white); }

        /* Painéis Admin (FIXED) */
        .admin-panel { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-color: var(--bg); z-index: 500; 
            transform: translateX(100%); transition: transform 0.3s ease; 
            display: none; flex-direction: column;
        }
        .admin-panel.active { transform: translateX(0); display: flex; }
        
        /* Z-Indexes */
        #admin-user-detail { z-index: 500; }
        #admin-race-editor { z-index: 510; }

        /* Inputs */
        .input-group { margin-bottom: 20px; text-align: left; width: 100%; }
        .label { display: block; font-size: 12px; font-weight: 700; color: var(--gray); text-transform: uppercase; margin-bottom: 8px; margin-left: 4px; }
        .input { width: 100%; padding: 16px 20px; border-radius: 16px; border: 1px solid transparent; background-color: var(--input-bg); font-size: 14px; color: var(--dark); font-weight: 500; font-family: inherit; outline: none; transition: 0.3s; }
        .input:focus { background-color: var(--white); border-color: var(--primary); box-shadow: 0 0 0 4px rgba(94, 92, 230, 0.15); }

        /* Botões */
        .btn { width: 100%; padding: 18px; border-radius: 16px; border: none; font-size: 16px; font-weight: 700; text-transform: uppercase; cursor: pointer; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; }
        .btn-primary { background-color: var(--primary); color: var(--white); box-shadow: 0 4px 20px rgba(94, 92, 230, 0.4); }
        .btn-primary:active { transform: scale(0.98); }
        .btn-text { background: none; color: var(--primary); text-transform: none; padding: 10px; border: none; font-weight: bold; cursor: pointer; font-family: inherit; font-size: 14px; }
        .btn-icon { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: none; cursor: pointer; background: #F2F2F7; color: var(--dark); transition: 0.2s; }
        .btn-icon.active { background: var(--primary); color: white; }

        /* Cards */
        .card { background: var(--white); padding: 24px; border-radius: 24px; box-shadow: 0 8px 30px rgba(0,0,0,0.05); margin-bottom: 20px; width: 100%; position: relative; }
        .quote-card { background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-left: 4px solid var(--primary); padding: 20px; border-radius: 16px; margin-bottom: 20px; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .quote-icon { position: absolute; top: -10px; right: 20px; font-size: 40px; color: rgba(94, 92, 230, 0.1); }

        /* Menu */
        .nav-bar { position: absolute; bottom: 0; left: 0; width: 100%; background: var(--white); padding: 15px 30px 30px; border-radius: 30px 30px 0 0; box-shadow: 0 -5px 40px rgba(0,0,0,0.05); display: flex; justify-content: space-between; z-index: 100; }
        .nav-item { background: none; border: none; color: #CCC; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; flex: 1; }
        .nav-item i { font-size: 24px; }
        .nav-item span { font-size: 10px; font-weight: 700; }
        .nav-item.active { color: var(--primary); }

        /* Lista Treinos */
        .timeline { position: relative; padding-left: 20px; }
        .line { position: absolute; left: 34px; top: 10px; bottom: 0; width: 2px; background: #E5E5E5; z-index: 0; }
        .workout { display: flex; align-items: center; margin-bottom: 20px; position: relative; z-index: 1; }
        .w-icon { width: 30px; height: 30px; border-radius: 50%; background: var(--white); border: 3px solid #E5E5E5; color: #E5E5E5; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; margin-right: 15px; flex-shrink: 0; }
        .workout.active .w-icon { border-color: var(--primary); color: var(--primary); background: var(--white); }
        .workout.done .w-icon { background: var(--green); border-color: var(--bg); color: var(--white); }
        .w-card { flex: 1; background: var(--white); padding: 16px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }

        /* Switch */
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; border-radius: 34px; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; border-radius: 50%; transition: .4s; }
        input:checked + .slider { background-color: var(--green); }
        input:checked + .slider:before { transform: translateX(22px); }
        
        /* Modals */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index: 400; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.active { display: flex; opacity: 1; pointer-events: auto; }
        .modal-card { background: white; width: 90%; max-width: 350px; border-radius: 24px; padding: 30px; transform: translateY(20px); transition: transform 0.3s; box-shadow: 0 20px 50px rgba(0,0,0,0.2); display: flex; flex-direction: column; max-height: 90vh; overflow-y: auto; }
        .modal-overlay.active .modal-card { transform: translateY(0); }

        /* Upload Avatar */
        .avatar-wrapper { width: 100%; height: 100%; position: relative; background: #EEE; display: flex; align-items: center; justify-content: center; color: #AAA; font-size: 24px; overflow: hidden; border-radius: 50%; }
        .avatar-wrapper img { width: 100%; height: 100%; object-fit: cover; display: none; } 
        .avatar-wrapper img.show { display: block; }
        .avatar-wrapper i { display: block; }
        .avatar-wrapper i.hide { display: none; }
        
        .avatar-upload-container { width: 100px; height: 100px; border-radius: 50%; overflow: hidden; margin: 0 auto 20px; position: relative; border: 4px solid var(--bg); cursor: pointer; background: #EEE; display: flex; align-items: center; justify-content: center; color: #AAA; font-size: 30px; }
        .avatar-upload-container img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .avatar-upload-container img.show { display: block; }
        .avatar-overlay { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; font-size: 10px; text-align: center; padding: 4px; font-weight: 700; }

        /* Editor Admin FIXED */
        #admin-editor { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 300; transform: translateY(100%); transition: transform 0.3s ease; display: flex; flex-direction: column; visibility: hidden; }
        #admin-editor.active { transform: translateY(0); visibility: visible; }

        .loader { display: none; border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin-right: 10px; }
        .btn-primary.loading .loader { display: block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- 1. LOGIN -->
    <div id="view-login" class="screen white-bg active">
        <button onclick="app.showAdminAuth()" style="position: absolute; top: 20px; right: 20px; border: none; background: none; color: #EEE; padding: 10px; cursor: pointer;"><i class="fa-solid fa-lock"></i></button>
        <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 40px; text-align: center;">
            <h1 style="font-size: 36px; margin-bottom: 10px; line-height: 1.1;">Bem-vindo<br>de volta!</h1>
            <p style="color: var(--gray); font-size: 14px; margin-bottom: 40px;">Entre para continuar seus treinos.</p>
            <form onsubmit="app.handleLogin(event)" style="width: 100%;">
                <div class="input-group"><label class="label">Email</label><input type="email" id="log-email" class="input" placeholder="seu@email.com" required></div>
                <div class="input-group"><label class="label">Senha</label><input type="password" id="log-pass" class="input" placeholder="******" required></div>
                <button type="submit" id="btn-login" class="btn btn-primary"><div class="loader"></div>ENTRAR</button>
            </form>
            <p id="login-error" style="color: var(--red); font-size: 12px; text-align: center; margin-top: 20px; display: none;">Email ou senha incorretos.</p>
            <div style="text-align: center; margin-top: 40px;"><p style="color: var(--gray); font-size: 14px;">Não tem uma conta? <button onclick="app.goToRegister()" class="btn-text" style="display:inline; padding:0;">Cadastre-se</button></p></div>
        </div>
    </div>

    <!-- 2. CADASTRO -->
    <div id="view-register" class="screen white-bg">
        <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 40px; text-align: center;">
            <button onclick="app.goToLogin()" style="position: absolute; top: 40px; left: 30px; background: none; border: none; color: var(--gray); padding: 0; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px;"><i class="fa-solid fa-chevron-left"></i> Voltar</button>
            <h1 style="font-size: 36px; line-height: 1.1; margin-bottom: 40px; margin-top: 40px;">Criar Nova<br>Conta</h1>
            <form onsubmit="app.handleRegister(event)" style="width: 100%;">
                <div class="input-group"><label class="label">Nome Completo</label><input type="text" id="reg-name" class="input" placeholder="Ex: Ana Silva" required></div>
                <div class="input-group"><label class="label">Email</label><input type="email" id="reg-email" class="input" placeholder="ana@email.com" required></div>
                <div class="input-group"><label class="label">Senha</label><input type="password" id="reg-pass" class="input" placeholder="******" required></div>
                <button type="submit" id="btn-reg" class="btn btn-primary"><div class="loader"></div>CADASTRAR</button>
            </form>
        </div>
    </div>

    <!-- 3. PENDENTE -->
    <div id="view-pending" class="screen white-bg" style="align-items: center; justify-content: center; padding: 40px; text-align: center;">
        <div style="width: 80px; height: 80px; background: rgba(255,149,0,0.1); color: var(--orange); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; margin-bottom: 30px;"><i class="fa-solid fa-hourglass-start"></i></div>
        <h2 style="font-size: 24px; margin-bottom: 10px;">Cadastro em Análise</h2>
        <p style="color: var(--gray); font-size: 14px; line-height: 1.6; margin-bottom: 40px;">Seu treinador precisa liberar seu acesso. Aguarde e tente logar novamente mais tarde.</p>
        <button onclick="app.goToLogin()" class="btn-text">VOLTAR AO LOGIN</button>
    </div>

    <!-- 4. APP ALUNO -->
    <div id="view-app" class="screen">
        <div class="scroll-content" style="padding-bottom: 100px; flex: 1; overflow-y: auto;">
            <!-- Aba HOME -->
            <div id="tab-home" class="tab-content" style="padding: 24px;">
                <div class="header" style="padding: 20px 0 30px; display:flex; justify-content:space-between; align-items:center;">
                    <div><h2 style="font-size: 26px; margin: 0;">Olá!</h2><p id="user-name" style="color: var(--gray); font-size: 14px; margin: 0;">Atleta</p></div>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <button onclick="app.logout()" style="width:40px; height:40px; border-radius:50%; background:white; color:var(--red); border:none; box-shadow:0 4px 10px rgba(0,0,0,0.05); cursor:pointer;"><i class="fa-solid fa-right-from-bracket"></i></button>
                        <div onclick="app.showProfileSettings()" style="width: 45px; height: 45px; border-radius: 50%; overflow: hidden; cursor: pointer; border: 2px solid var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <div class="avatar-wrapper" id="avatar-wrapper-home"><i class="fa-solid fa-user"></i><img src="" alt="Avatar"></div>
                        </div>
                    </div>
                </div>
                <!-- Prova -->
                <div class="card" style="background: var(--dark); color: var(--white);">
                    <div style="display: flex; justify-content: space-between;">
                        <div><span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 700;">PRÓXIMO DESAFIO</span><h3 id="app-race" style="font-size: 22px; margin: 15px 0 5px;">...</h3><p id="app-date" style="font-size: 12px; color: #AAA; margin: 0;">...</p></div>
                        <div style="font-size: 24px; color: var(--primary);"><i class="fa-solid fa-trophy"></i></div>
                    </div>
                    <div style="margin-top: 30px;">
                        <div style="height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;"><div id="app-progress" style="width: 0%; height: 100%; background: var(--green);"></div></div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 12px; color: #AAA;">
                            <span id="app-remaining" style="font-weight: 500;">Calculando...</span>
                            <span id="app-percent" style="color: var(--green); font-weight: 700;">0% Concluído</span>
                        </div>
                    </div>
                </div>
                <!-- Frase -->
                <div id="quote-section" class="quote-card"><i class="fa-solid fa-quote-right quote-icon"></i><p id="daily-quote" style="font-size: 14px; color: var(--dark); font-weight: 500; font-style: italic; line-height: 1.6;">"Carregando inspiração..."</p><p style="font-size: 10px; color: var(--gray); margin-top: 10px; text-transform: uppercase; font-weight: 700;">Motivação do Dia</p></div>
                
                <!-- Botão Novo Objetivo -->
                <button onclick="app.showAddRaceModal()" style="background:white; border: 1px dashed var(--primary); color: var(--primary); margin-top: 20px; width: 100%; padding: 12px; border-radius: 16px; font-weight: 700; cursor: pointer;">+ DEFINIR NOVO OBJETIVO</button>
            </div>
            <!-- TREINOS -->
            <div id="tab-workouts" class="tab-content hidden" style="padding: 24px;">
                <h2 style="margin-bottom: 20px; margin-top: 20px;">Sua Planilha</h2>
                <div class="timeline"><div class="line"></div><div id="workouts-container"></div></div>
            </div>
            <!-- PERFIL -->
            <div id="tab-profile" class="tab-content hidden" style="padding: 40px; text-align: center;">
                <div style="width: 100px; height: 100px; background: #DDD; border-radius: 50%; margin: 0 auto 20px; overflow: hidden;"><div class="avatar-wrapper" id="avatar-wrapper-profile" style="font-size: 40px;"><i class="fa-solid fa-user"></i><img src="" alt="Avatar"></div></div>
                <h2 id="profile-name" style="margin: 0;">Nome</h2>
                <p style="color: var(--primary); font-size: 12px; font-weight: 700; background: rgba(94,92,230,0.1); display: inline-block; padding: 5px 15px; border-radius: 20px; margin-top: 10px;">ALUNO ATIVO</p>
                
                <!-- HISTÓRICO DE CONQUISTAS -->
                <div style="margin-top: 40px; text-align: left;">
                    <h3 style="font-size: 14px; color: var(--gray); text-transform: uppercase; font-weight: 700; margin-bottom: 20px;">Histórico de Conquistas</h3>
                    <div id="profile-history-list" style="display: flex; flex-direction: column; gap: 15px;"></div>
                </div>

                <button onclick="app.showProfileSettings()" class="btn" style="background: var(--white); border: 1px solid #EEE; color: var(--gray); margin-top: 30px;">Editar Perfil</button>
            </div>
        </div>
        <!-- Menu -->
        <div class="nav-bar">
            <button class="nav-item active" onclick="app.nav('home')" data-tab="home"><i class="fa-solid fa-house"></i><span>Início</span></button>
            <button class="nav-item" onclick="app.nav('workouts')" data-tab="workouts"><i class="fa-solid fa-calendar-check"></i><span>Treino</span></button>
            <button class="nav-item" onclick="app.nav('profile')" data-tab="profile"><i class="fa-solid fa-user"></i><span>Perfil</span></button>
        </div>
    </div>

    <!-- 5. ADMIN -->
    <div id="view-admin" class="screen" style="background: var(--bg);">
        <div class="header" style="background: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 20px 24px;">
            <h3>Painel Treinador</h3>
            <div>
                <button onclick="app.adminTab('users')" class="btn-icon active" id="adm-tab-users" style="margin-right: 10px;"><i class="fa-solid fa-users"></i></button>
                <button onclick="app.adminTab('quotes')" class="btn-icon" id="adm-tab-quotes" style="margin-right: 10px;"><i class="fa-solid fa-quote-right"></i></button>
                <button onclick="app.goToLogin()" style="border: none; background: none; color: var(--red); font-weight: bold; cursor: pointer; font-size: 12px;">Sair</button>
            </div>
        </div>
        <div id="admin-content-users" style="padding: 24px; overflow-y: auto; flex: 1;"><div id="admin-list" style="display: flex; flex-direction: column; gap: 10px;"></div></div>
        <div id="admin-content-quotes" class="hidden" style="padding: 24px; overflow-y: auto; flex: 1;">
            <div class="card"><div class="input-group" style="margin-bottom: 10px;"><label class="label">Nova Frase</label><textarea id="new-quote-text" class="input" style="resize: none; height: 80px;"></textarea></div><button onclick="app.addQuote()" class="btn btn-primary" style="padding: 12px; font-size: 14px;">ADICIONAR FRASE</button></div>
            <div id="admin-quotes-list" style="display: flex; flex-direction: column; gap: 10px;"></div>
        </div>
    </div>

    <!-- 6. ADMIN: PERFIL DO ALUNO (NÍVEL 2) -->
    <div id="admin-user-detail" class="admin-panel">
        <div style="padding: 20px; background: var(--white); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <button onclick="app.closeUserDetail()" style="border: none; background: none; font-size: 20px; cursor: pointer;"><i class="fa-solid fa-chevron-down"></i></button>
            <h3 style="margin: 0; font-size: 16px;">Perfil do Aluno</h3>
            <button onclick="app.saveUserAccess()" style="border: none; background: var(--primary); color: white; padding: 8px 20px; border-radius: 10px; font-weight: 700; cursor: pointer;">Salvar</button>
        </div>
        <div style="flex: 1; overflow-y: auto; padding: 24px;">
            <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
                <div><strong id="adm-detail-name" style="font-size: 18px;">Nome</strong><p id="adm-detail-email" style="font-size: 12px; color: var(--gray); margin: 0;">email</p></div>
                <label class="switch"><input type="checkbox" id="adm-detail-active"><span class="slider"></span></label>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; margin-top: 30px;">
                <h4 style="margin: 0; font-size: 14px; color: var(--dark);">CICLOS DE TREINO</h4>
                <button onclick="app.addRace()" style="border: 1px dashed var(--primary); background: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; color: var(--primary); cursor: pointer;">+ Nova Prova</button>
            </div>
            <div id="adm-races-list" style="display: flex; flex-direction: column; gap: 10px; padding-bottom: 50px;"></div>
        </div>
    </div>

    <!-- 7. ADMIN: EDITOR DE TREINOS (NÍVEL 3) -->
    <div id="admin-race-editor" class="admin-panel">
        <div style="padding: 20px; background: var(--white); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <button onclick="app.closeRaceEditor()" style="border: none; background: none; font-size: 20px; cursor: pointer;"><i class="fa-solid fa-chevron-left"></i></button>
            <h3 style="margin: 0; font-size: 16px;">Editar Treinos</h3>
            <button onclick="app.saveRaceData()" style="border: none; background: var(--primary); color: white; padding: 8px 20px; border-radius: 10px; font-weight: 700; cursor: pointer;">Salvar</button>
        </div>
        <div style="flex: 1; overflow-y: auto; padding: 24px;">
            <div class="card">
                <div class="input-group"><label class="label">Nome da Prova</label><input type="text" id="adm-race-name" class="input" placeholder="Ex: Maratona"></div>
                <div class="input-group" style="margin: 0;"><label class="label">Data</label><input type="date" id="adm-race-date" class="input"></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 style="margin: 0; font-size: 12px; color: var(--gray);">LISTA DE TREINOS</h4>
                <div>
                    <button onclick="app.addWorkout()" style="border: 1px solid #DDD; background: white; padding: 5px 10px; border-radius: 8px; font-size: 10px; font-weight: 700; color: var(--primary); cursor: pointer; margin-right: 5px;">+ Treino</button>
                    <button onclick="app.fillDefaults()" style="border: 1px solid #DDD; background: white; padding: 5px 10px; border-radius: 8px; font-size: 10px; font-weight: 700; color: var(--gray); cursor: pointer;">Padrão</button>
                </div>
            </div>
            <div id="adm-workouts-list" style="display: flex; flex-direction: column; gap: 10px; padding-bottom: 50px;"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-profile-settings" class="modal-overlay" style="display: none;">
        <div class="modal-card"><h3 style="margin-top: 0; text-align: center; margin-bottom: 20px;">Editar Perfil</h3><div class="avatar-upload-container" onclick="document.getElementById('edit-profile-file').click()"><div class="avatar-wrapper" id="avatar-wrapper-edit" style="font-size: 40px;"><i class="fa-solid fa-user"></i><img src="" alt="Avatar"></div><div class="avatar-overlay">ALTERAR</div><input type="file" id="edit-profile-file" accept="image/*" style="display: none;" onchange="app.handleAvatarPreview(this)"></div><div class="input-group"><label class="label">Seu Nome</label><input type="text" id="edit-profile-name" class="input"></div><button onclick="app.saveProfileSettings()" class="btn btn-primary" style="margin-bottom: 10px;">Salvar Alterações</button><button onclick="app.closeProfileSettings()" class="btn-text" style="width: 100%;">Cancelar</button></div>
    </div>
    <div id="modal-admin-auth" class="modal-overlay" style="display: none;">
        <div class="modal-card"><h3 style="margin-top: 0; text-align: center; margin-bottom: 20px;">Acesso Treinador</h3><div class="input-group"><label class="label">Senha Mestra</label><input type="password" id="admin-pass-input" class="input" placeholder="******"></div><div style="display: flex; gap: 10px;"><button onclick="app.closeAdminAuth()" class="btn" style="background: #EEE; color: #555;">Cancelar</button><button onclick="app.checkAdminAuth()" class="btn btn-primary">Entrar</button></div></div>
    </div>
    <div id="modal-add-race" class="modal-overlay" style="display: none;">
        <div class="modal-card"><h3 style="margin-top: 0; text-align: center; margin-bottom: 20px;">Novo Objetivo</h3><div class="input-group"><label class="label">Nome da Prova</label><input type="text" id="new-race-name" class="input" placeholder="Ex: Corrida 5K"></div><div class="input-group"><label class="label">Data</label><input type="date" id="new-race-date" class="input"></div><div style="display: flex; gap: 10px;"><button onclick="app.closeAddRaceModal()" class="btn" style="background: #EEE; color: #555;">Cancelar</button><button onclick="app.saveStudentRace()" class="btn btn-primary">Criar</button></div></div>
    </div>

    <!-- FIREBASE LÓGICA -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, onSnapshot, updateDoc, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const geminiApiKey = "AIzaSyCmJ1MbVas_XC1OeulSSqOXOabKP-u4Sj8"; 
        
        // SUAS CHAVES DO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyAZc5IXA3PRIadz87sysrC_7lLZZG-7Izw",
            authDomain: "app-corrida-d3568.firebaseapp.com",
            projectId: "app-corrida-d3568",
            storageBucket: "app-corrida-d3568.firebasestorage.app",
            messagingSenderId: "690843260846",
            appId: "1:690843260846:web:e32be21759c9e813bada3f",
            measurementId: "G-26RNCCZYED"
        };

        let appInit, auth, db; let useMock = false;
        try { appInit = initializeApp(firebaseConfig); auth = getAuth(appInit); db = getFirestore(appInit); } catch (e) { useMock = true; }

        const usersColl = 'expliq_users_v8'; // Nova Versão com histórico
        const quotesColl = 'expliq_quotes_v8';
        const getRef = (c) => useMock ? null : collection(db, c);
        const getDocRef = (c, k) => useMock ? null : doc(db, c, k.replace(/[^a-zA-Z0-9]/g, '_'));

        window.app = {
            currentUser: null, editEmail: null, editUser: null, editRaceIndex: null, 
            unsubscribeUser: null, unsubscribeAdmin: null, unsubscribeQuotes: null, mockDB: [],
            mockQuotes: ["Persistência é o caminho do êxito.", "Corra hoje, vença amanhã."],

            setAvatar: (wId, url) => {
                const w = document.getElementById(wId); if(!w)return;
                const i = w.querySelector('img'), ic = w.querySelector('i');
                if(url && url.length>20) { i.src=url; i.style.display='block'; if(ic)ic.style.display='none'; }
                else { i.src=''; i.style.display='none'; if(ic)ic.style.display='block'; }
            },
            init: async () => {
                if(!useMock) { try{ await signInAnonymously(auth); }catch(e){} }
                const local = localStorage.getItem('expliq_local_db_v8'); if(local) app.mockDB = JSON.parse(local);
                app.switchScreen('view-login');
            },
            saveLocal: () => { if(useMock) localStorage.setItem('expliq_local_db_v8', JSON.stringify(app.mockDB)); },
            switchScreen: (id) => { document.querySelectorAll('.screen').forEach(e=>e.classList.remove('active')); document.getElementById(id).classList.add('active'); },
            
            // Auth & Profile
            goToLogin: () => { document.getElementById('login-error').style.display='none'; app.switchScreen('view-login'); },
            goToRegister: () => app.switchScreen('view-register'),
            logout: () => { app.currentUser=null; document.querySelectorAll('input').forEach(i=>i.value=''); app.switchScreen('view-login'); },
            showProfileSettings: () => { const u = app.currentUser; document.getElementById('edit-profile-name').value = u.name; app.setAvatar('avatar-wrapper-edit', u.avatar); document.getElementById('modal-profile-settings').style.display='flex'; setTimeout(()=>document.getElementById('modal-profile-settings').classList.add('active'),10); },
            closeProfileSettings: () => { document.getElementById('modal-profile-settings').classList.remove('active'); setTimeout(()=>document.getElementById('modal-profile-settings').style.display='none',300); },
            handleAvatarPreview: (input) => { if(input.files && input.files[0]) { const r = new FileReader(); r.onload=(e)=>{ const img=new Image(); img.src=e.target.result; img.onload=()=>{ const c=document.createElement('canvas'),x=c.getContext('2d'); let w=img.width,h=img.height,m=150; if(w>h){if(w>m){h*=m/w;w=m}}else{if(h>m){w*=m/h;h=m}} c.width=w;c.height=h; x.drawImage(img,0,0,w,h); app.setAvatar('avatar-wrapper-edit',c.toDataURL('image/jpeg',0.7)); }}; r.readAsDataURL(input.files[0]); } },
            
            // FIX: CORREÇÃO DE PERSISTÊNCIA DO AVATAR
            saveProfileSettings: async () => { 
                const n = document.getElementById('edit-profile-name').value;
                const imgEl = document.querySelector('#avatar-wrapper-edit img');
                // Pega o SRC apenas se a imagem estiver visível (classe 'show' ou display block)
                const a = (imgEl.style.display === 'block') ? imgEl.src : null;
                
                app.currentUser.name = n;
                app.currentUser.avatar = a;
                
                // Atualiza MockDB se estiver offline
                if(useMock) {
                    const idx = app.mockDB.findIndex(u => u.email === app.currentUser.email);
                    if(idx > -1) app.mockDB[idx] = app.currentUser;
                    app.saveLocal();
                }
                
                app.loadAppUI();
                app.closeProfileSettings();
                
                if (!useMock) await updateDoc(getDocRef(usersColl, app.currentUser.email), { name: n, avatar: a });
            },

            handleRegister: async (e) => { e.preventDefault(); const btn=document.getElementById('btn-reg'); btn.classList.add('loading'); const name=document.getElementById('reg-name').value, email=document.getElementById('reg-email').value.toLowerCase(), pass=document.getElementById('reg-pass').value; const newUser={name,email,pass,active:false,races:[],avatar:null}; if(!useMock){try{await setDoc(getDocRef(usersColl,email),newUser);}catch(e){useMock=true;app.mockDB.push(newUser);app.saveLocal();}}else{app.mockDB.push(newUser);app.saveLocal();} btn.classList.remove('loading'); app.switchScreen('view-pending'); },
            handleLogin: async (e) => { e.preventDefault(); const btn=document.getElementById('btn-login'); const err=document.getElementById('login-error'); btn.classList.add('loading'); err.style.display='none'; const email=document.getElementById('log-email').value.toLowerCase(), pass=document.getElementById('log-pass').value; let user=null; if(!useMock){try{const s=await getDoc(getDocRef(usersColl,email));if(s.exists())user=s.data();}catch(e){}} if(!user)user=app.mockDB.find(u=>u.email===email); btn.classList.remove('loading'); if(user && user.pass===pass){ app.currentUser=user; if(!useMock){if(app.unsubscribeUser)app.unsubscribeUser();app.unsubscribeUser=onSnapshot(getDocRef(usersColl,email),(d)=>{if(d.exists()){app.currentUser=d.data();if(document.getElementById('view-app').classList.contains('active'))app.loadAppUI();if(app.currentUser.active && document.getElementById('view-pending').classList.contains('active')){app.loadAppUI();app.switchScreen('view-app');}}});} app.loadRandomQuote(); user.active?(app.loadAppUI(),app.switchScreen('view-app')):app.switchScreen('view-pending'); }else{err.innerText='Credenciais inválidas.';err.style.display='block';} },
            
            // APP UI
            loadAppUI: () => {
                const u = app.currentUser; const races = u.races || []; const activeRace = races.length > 0 ? races[races.length - 1] : null;
                document.getElementById('user-name').innerText = u.name; app.setAvatar('avatar-wrapper-home', u.avatar); app.setAvatar('avatar-wrapper-profile', u.avatar); document.getElementById('profile-name').innerText = u.name;
                document.getElementById('app-race').innerText = activeRace ? activeRace.name : 'Aguardando...';
                let d = 'DATA INDEFINIDA'; if(activeRace && activeRace.date) d = activeRace.date.split('-').reverse().join('/'); document.getElementById('app-date').innerText = d;
                const cont = document.getElementById('workouts-container'); cont.innerHTML = '';
                let done = 0; const workouts = activeRace ? (activeRace.workouts || []) : [];
                if(workouts.length === 0) cont.innerHTML = '<div style="text-align:center; padding:40px; color:#AAA;">Nenhum treino.</div>';
                else {
                    workouts.forEach((w, i) => {
                        if (w.done) done++;
                        const next = !w.done && (i === 0 || workouts[i-1].done);
                        let h = '';
                        if (w.done) h = `<div class="workout done"><div class="w-icon"><i class="fa-solid fa-check"></i></div><div class="w-card" style="display:flex; justify-content:space-between;"><span style="text-decoration:line-through; color:#AAA;">${w.title}</span><span style="color:var(--green); font-size:10px; font-weight:700;">FEITO</span></div></div>`;
                        else if (next) h = `<div class="workout active"><div class="w-icon">${i+1}</div><div class="w-card" style="border-left:4px solid var(--primary);"><span style="color:var(--primary); font-size:10px; font-weight:700;">HOJE</span><h4 style="margin:5px 0;">${w.title}</h4><p style="font-size:12px; color:#888; margin-bottom:15px;">${w.desc}</p><button onclick="app.finishWorkout(${i})" class="btn btn-primary" style="padding:10px; font-size:12px;">CONCLUIR</button></div></div>`;
                        else h = `<div class="workout" style="opacity:0.5;"><div class="w-icon">${i+1}</div><div class="w-card"><h4 style="margin:0; font-size:14px;">${w.title}</h4><span style="font-size:10px;">Bloqueado</span></div></div>`;
                        cont.innerHTML += h;
                    });
                }
                const pct = workouts.length > 0 ? Math.round((done/workouts.length)*100) : 0;
                document.getElementById('app-progress').style.width = pct+'%'; document.getElementById('app-remaining').innerText = `Faltam ${workouts.length-done} treinos`; document.getElementById('app-percent').innerText = `${pct}%`;
                
                // HISTORICO
                const hList = document.getElementById('profile-history-list');
                if(hList) {
                    hList.innerHTML = '';
                    if(races.length===0) hList.innerHTML='<p style="text-align:center;font-size:12px;color:#AAA;">Sem histórico.</p>';
                    [...races].reverse().forEach(r=>{
                        const tW = r.workouts?.length||0; const dW = r.workouts ? r.workouts.filter(k=>k.done).length : 0;
                        const p = tW>0?Math.round((dW/tW)*100):0; const isC=p===100;
                        const ic=isC?'fa-medal':'fa-person-running'; const clr=isC?'#FBC02D':'#CCC';
                        hList.innerHTML+=`<div class="card" style="padding:15px; margin-bottom:10px; display:flex; align-items:center; gap:15px;"><div style="width:40px; height:40px; background:${isC?'#FFF9C4':'#F5F5F5'}; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:18px; color:${clr};"><i class="fa-solid ${ic}"></i></div><div style="flex:1;"><h4 style="margin:0; font-size:14px; color:var(--dark);">${r.name}</h4><p style="margin:0; font-size:10px; color:var(--gray);">${r.date||''}</p></div><span style="font-size:12px; font-weight:bold; color:${isC?'var(--green)':'var(--primary)'};">${p}%</span></div>`;
                    });
                }
            },
            finishWorkout: async (i) => {
                const races = app.currentUser.races; const activeIdx = races.length - 1; races[activeIdx].workouts[i].done = true;
                app.loadAppUI(); if (!useMock) await updateDoc(getDocRef(usersColl, app.currentUser.email), { races: races }); else app.saveLocal();
            },
            nav: (t) => { document.querySelectorAll('.tab-content').forEach(e=>e.classList.add('hidden')); document.getElementById('tab-'+t).classList.remove('hidden'); document.querySelectorAll('.nav-item').forEach(e=>{e.classList.remove('active'); if(e.dataset.tab===t)e.classList.add('active');}); },
            loadRandomQuote: async () => { if(geminiApiKey){ try{ const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${geminiApiKey}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:"Frase curta motivacional corrida."}]}]})}); const d=await r.json(); const q=d.candidates?.[0]?.content?.parts?.[0]?.text?.trim(); if(q){ document.getElementById('daily-quote').innerText=`"${q}"`; return; } }catch(e){} } if(!useMock){onSnapshot(getRef(quotesColl),(s)=>{if(!s.empty){const a=[];s.forEach(d=>a.push(d.data().text));if(a.length>0)document.getElementById('daily-quote').innerText=`"${a[Math.floor(Math.random()*a.length)]}"`;}});} else document.getElementById('daily-quote').innerText=`"${app.mockQuotes[Math.floor(Math.random()*app.mockQuotes.length)]}"`; },

            // STUDENT ADD RACE
            showAddRaceModal: () => { document.getElementById('modal-add-race').style.display='flex'; setTimeout(()=>document.getElementById('modal-add-race').classList.add('active'),10); document.getElementById('new-race-name').value=''; document.getElementById('new-race-date').value=''; },
            closeAddRaceModal: () => { document.getElementById('modal-add-race').classList.remove('active'); setTimeout(()=>document.getElementById('modal-add-race').style.display='none',300); },
            saveStudentRace: async () => {
                const n=document.getElementById('new-race-name').value; const d=document.getElementById('new-race-date').value;
                if(!n) return alert("Nome obrigatório");
                const races = app.currentUser.races || [];
                races.push({name:n, date:d, workouts:[]}); // Starts empty
                app.currentUser.races = races;
                app.loadAppUI(); app.closeAddRaceModal();
                if(!useMock) await updateDoc(getDocRef(usersColl, app.currentUser.email), {races:races}); else app.saveLocal();
                alert('Objetivo criado!');
            },

            // ADMIN
            showAdminAuth: () => { document.getElementById('modal-admin-auth').style.display='flex'; setTimeout(()=>document.getElementById('modal-admin-auth').classList.add('active'),10); document.getElementById('admin-pass-input').value=''; },
            closeAdminAuth: () => { document.getElementById('modal-admin-auth').classList.remove('active'); setTimeout(()=>document.getElementById('modal-admin-auth').style.display='none',300); },
            checkAdminAuth: () => { if(document.getElementById('admin-pass-input').value === 'admin123') { app.closeAdminAuth(); app.goToAdmin(); } else alert("Senha incorreta"); },
            goToAdmin: () => {
                app.switchScreen('view-admin'); app.adminTab('users');
                if (!useMock) {
                    if (app.unsubscribeAdmin) app.unsubscribeAdmin();
                    app.unsubscribeAdmin = onSnapshot(getRef(usersColl), (s) => { const l=[]; s.forEach(d=>l.push(d.data())); app.renderAdminList(l); });
                    if (app.unsubscribeQuotes) app.unsubscribeQuotes();
                    app.unsubscribeQuotes = onSnapshot(getRef(quotesColl), (s) => { const l=[]; s.forEach(d=>l.push({id:d.id,...d.data()})); app.renderAdminQuotes(l); });
                } else { app.renderAdminList(app.mockDB); app.renderAdminQuotes(app.mockQuotes.map((q,i)=>({id:i,text:q}))); }
            },
            adminTab: (t) => { document.querySelectorAll('[id^="admin-content"]').forEach(e=>e.classList.add('hidden')); document.querySelectorAll('.btn-icon').forEach(e=>e.classList.remove('active')); document.getElementById('admin-content-'+t).classList.remove('hidden'); document.getElementById('adm-tab-'+t).classList.add('active'); },
            renderAdminList: (users) => {
                const l=document.getElementById('admin-list'); l.innerHTML='';
                if(!users||users.length===0){ l.innerHTML='<p style="text-align:center; color:#AAA;">Vazio.</p>'; return; }
                users.forEach(u=>{
                    // MODIFIED: Add progress bar to admin list
                    const races = u.races || [];
                    const activeR = races.length > 0 ? races[races.length-1] : null;
                    const done = activeR ? activeR.workouts.filter(w=>w.done).length : 0;
                    const total = activeR ? (activeR.workouts.length||1) : 1;
                    const pct = Math.round((done/total)*100);
                    const rName = activeR ? activeR.name : 'Sem prova';

                    const st = u.active ? '<span style="color:var(--green); font-weight:bold; font-size:10px;">ATIVO</span>' : '<span style="color:var(--orange); font-weight:bold; font-size:10px;">PENDENTE</span>';
                    const d=document.createElement('div'); d.className='card'; d.style.cssText='display:flex; flex-direction:column; gap:10px; cursor:pointer;';
                    d.innerHTML=`
                        <div style="display:flex; justify-content:space-between; align-items:center; width:100%;"><div><h4 style="margin:0;">${u.name}</h4><p style="margin:0; font-size:12px; color:#888;">${u.email}</p></div>${st}</div>
                        <div style="width:100%;"><div style="display:flex; justify-content:space-between; font-size:10px; color:#AAA; margin-bottom:3px;"><span>${rName}</span><span>${done}/${total} (${pct}%)</span></div><div style="width:100%; height:4px; background:#F2F2F7; border-radius:2px;"><div style="width:${pct}%; height:100%; background:var(--primary);"></div></div></div>
                    `;
                    d.onclick=()=>app.openUser(u); l.appendChild(d);
                });
            },
            renderAdminQuotes: (qs) => {
                const l=document.getElementById('admin-quotes-list'); l.innerHTML='';
                qs.forEach(q=>{ l.innerHTML+=`<div class="card" style="padding:15px; display:flex; justify-content:space-between; align-items:center;"><p style="margin:0; font-size:12px; font-style:italic;">"${q.text}"</p><button onclick="app.deleteQuote('${q.id}')" style="border:none; background:none; color:var(--red); cursor:pointer;"><i class="fa-solid fa-trash"></i></button></div>`; });
            },
            // FIX: Delete Quote Function
            addQuote: async ()=>{ const t=document.getElementById('new-quote-text').value; if(!t)return; if(!useMock) await addDoc(getRef(quotesColl),{text:t,created:Date.now()}); else { app.mockQuotes.push(t); app.renderAdminQuotes(app.mockQuotes.map((q,i)=>({id:i,text:q}))); } document.getElementById('new-quote-text').value=''; },
            deleteQuote: async (id)=>{ 
                if(!useMock) {
                    await deleteDoc(doc(db, quotesColl, id)); 
                } else { 
                    // Mock delete by index (id passed as index)
                    const idx = parseInt(id);
                    if (!isNaN(idx)) {
                        app.mockQuotes.splice(idx, 1);
                        app.renderAdminQuotes(app.mockQuotes.map((q,i)=>({id:i,text:q})));
                    }
                } 
            },
            
            // Level 1: User Detail
            openUser: (u) => {
                app.editEmail = u.email;
                if(!useMock) getDoc(getDocRef(usersColl, u.email)).then(s=>{ if(s.exists()) app.renderUserDetail(s.data()); });
                else app.renderUserDetail(app.mockDB.find(x=>x.email===u.email));
                document.getElementById('admin-user-detail').classList.add('active');
            },
            renderUserDetail: (u) => {
                app.editUser = u; document.getElementById('adm-detail-name').innerText=u.name; document.getElementById('adm-detail-email').innerText=u.email; document.getElementById('adm-detail-active').checked=u.active;
                const l = document.getElementById('adm-races-list'); l.innerHTML=''; const rs = u.races || [];
                if(rs.length===0) l.innerHTML='<p style="font-size:12px; color:#AAA;">Nenhuma prova criada.</p>';
                [...rs].reverse().forEach((r, i) => {
                    const originalIndex = rs.length - 1 - i;
                    const d = document.createElement('div'); d.className='card'; d.style.padding='15px'; d.style.cursor='pointer';
                    const t = r.workouts?.length||0; const dn = r.workouts?r.workouts.filter(w=>w.done).length:0; const p = t>0?Math.round((dn/t)*100):0;
                    d.innerHTML = `<div style="display:flex; justify-content:space-between;"><strong>${r.name}</strong><span style="font-size:12px; color:#888;">${r.date||''}</span></div><p style="margin:5px 0 0; font-size:12px; color:#AAA;">${t} treinos (${p}%)</p>`;
                    d.onclick = () => app.openRace(originalIndex);
                    l.appendChild(d);
                });
            },
            closeUserDetail: () => document.getElementById('admin-user-detail').classList.remove('active'),
            saveUserAccess: async () => {
                const a = document.getElementById('adm-detail-active').checked;
                if(!useMock) await updateDoc(getDocRef(usersColl, app.editEmail), {active:a}); else { const i=app.mockDB.findIndex(x=>x.email===app.editEmail); if(i>-1)app.mockDB[i].active=a; app.saveLocal(); app.renderAdminList(app.mockDB); }
                alert('Salvo!'); app.closeUserDetail();
            },
            addRace: () => { if(!app.editUser.races) app.editUser.races=[]; app.editUser.races.push({name:'Nova Prova', date:'', workouts:[]}); app.openRace(app.editUser.races.length-1); },
            
            // Level 2: Race Editor
            openRace: (idx) => {
                app.editRaceIndex = idx; const r = app.editUser.races[idx];
                document.getElementById('adm-race-name').value = r.name; document.getElementById('adm-race-date').value = r.date;
                app.renderWorkoutInputs(r.workouts);
                document.getElementById('admin-race-editor').classList.add('active');
            },
            closeRaceEditor: () => document.getElementById('admin-race-editor').classList.remove('active'),
            renderWorkoutInputs: (wks) => {
                const l=document.getElementById('adm-workouts-list'); l.innerHTML='';
                wks.forEach((w, i)=>{
                    const d=document.createElement('div'); d.style.cssText="background:#FFF; border:1px solid #EEE; padding:10px; border-radius:10px; display:flex; gap:10px; margin-bottom:10px;";
                    d.innerHTML=`<span style="font-weight:700; color:#AAA; font-size:12px; margin-top:5px;">${i+1}</span><div style="flex:1;"><input class="edt-t" value="${w.title}" placeholder="Título" style="width:100%; border:none; font-weight:700; font-size:12px; margin-bottom:5px; outline:none;"><input class="edt-d" value="${w.desc}" placeholder="Detalhes..." style="width:100%; border:none; font-size:11px; color:#666; outline:none;"></div><button onclick="this.parentElement.remove()" style="color:var(--red); background:none; border:none; font-weight:bold;">X</button>`;
                    l.appendChild(d);
                });
            },
            addWorkout: () => {
                const l=document.getElementById('adm-workouts-list'); const i=l.children.length+1;
                const d=document.createElement('div'); d.style.cssText="background:#FFF; border:1px solid #EEE; padding:10px; border-radius:10px; display:flex; gap:10px; margin-bottom:10px;";
                d.innerHTML=`<span style="font-weight:700; color:#AAA; font-size:12px; margin-top:5px;">${i}</span><div style="flex:1;"><input class="edt-t" placeholder="Título" style="width:100%; border:none; font-weight:700; font-size:12px; margin-bottom:5px; outline:none;"><input class="edt-d" placeholder="Detalhes..." style="width:100%; border:none; font-size:11px; color:#666; outline:none;"></div><button onclick="this.parentElement.remove()" style="color:var(--red); background:none; border:none; font-weight:bold;">X</button>`;
                l.appendChild(d);
            },
            saveRaceData: async () => {
                const rN=document.getElementById('adm-race-name').value; const rD=document.getElementById('adm-race-date').value;
                const ts=document.querySelectorAll('.edt-t'); const ds=document.querySelectorAll('.edt-d'); const w=[];
                ts.forEach((t,i)=>w.push({title:t.value, desc:ds[i].value, done:false}));
                app.editUser.races[app.editRaceIndex] = { name:rN, date:rD, workouts:w };
                if(!useMock) await updateDoc(getDocRef(usersColl, app.editEmail), {races:app.editUser.races});
                else { const idx=app.mockDB.findIndex(u=>u.email===app.editEmail); if(idx>-1) app.mockDB[idx].races=app.editUser.races; app.saveLocal(); }
                alert('Salvo!'); app.closeRaceEditor(); app.renderUserDetail(app.editUser);
            },
            fillDefaults: () => {
                const l=document.getElementById('adm-workouts-list');
                const tpls=[
                  {t:'Corrida 1: Caminhada Leve', d:'30 min de Caminhada em Zona 1 (Z1 - ritmo fácil).'},
                  {t:'Fortalecimento 1: Força Base', d:'3x10 Agachamento, 3x10 Afundo (por perna), 3x15 Elevação de panturrilha.'},
                  {t:'Corrida 2: Início da Corrida (C/C)', d:'5 min aquecimento + (30 seg corrida / 90 seg caminhada) x 8 repetições + 5 min volta à calma.'},
                  {t:'Corrida 3: Caminhada Acelerada', d:'40 min de Caminhada Z1/Z2 (aumentar levemente o ritmo).'},
                  {t:'Corrida 4: Intervalos 1:2', d:'5 min aquecimento + (1 min corrida / 2 min caminhada) x 7 repetições + 5 min volta à calma.'},
                  {t:'Fortalecimento 2: Core e Postura', d:'3x45 seg Prancha frontal, 3x15 Elevação de quadril (ponte), 3x15 Superman.'},
                  {t:'Corrida 5: Aumento da Corrida', d:'5 min aquecimento + (1 min corrida / 1 min caminhada) x 10 repetições + 5 min volta à calma.'},
                  {t:'Corrida 6: Duração (30 min C/C)', d:'5 min aquecimento + (2 min corrida / 1 min caminhada) x 8 repetições + 5 min volta à calma.'},
                  {t:'Fortalecimento 3: Resistência Leve', d:'3x12 Agachamento livre/leve peso, 3x10 Flexão de braço (com apoio), 3x20 Abdominal remador.'},
                  {t:'Corrida 7: 3km C/C (Total)', d:'5 min aquecimento + (3 min corrida / 1 min caminhada) x 6 repetições + 5 min volta à calma. Total: 30 min de esforço.'},
                  {t:'Corrida 8: Mais Corrida (40 min C/C)', d:'5 min aquecimento + (4 min corrida / 1 min caminhada) x 7 repetições + 5 min volta à calma.'},
                  {t:'Fortalecimento 4: Mobilidade e Estabilidade', d:'3x10 Rotação externa de ombro, 3x10 Passada lateral com mini band, 3x10 Extensão de tronco.'},
                  {t:'Corrida 9: Longão Curto (3.5km)', d:'5 min aquecimento + 18 minutos de corrida contínua em ritmo Z2 + 5 min volta à calma.'},
                  {t:'Corrida 10: Ritmo Estável (45 min C/C)', d:'5 min aquecimento + (5 min corrida / 1 min caminhada) x 6 repetições + 5 min volta à calma.'},
                  {t:'Fortalecimento 5: Força e Potência Leve', d:'3x8 Salto vertical (box jump baixo), 3x12 Peso Morto (RDL) leve, 3x15 Elevação de joelhos.'},
                  {t:'Corrida 11: 4km Contínuos (Desafio)', d:'5 min aquecimento + 20 minutos de corrida contínua em Z2 + 5 min volta à calma.'},
                  {t:'Corrida 12: Revezamento 1:1', d:'5 min aquecimento + (2 min corrida / 2 min caminhada) x 10 repetições + 5 min volta à calma.'},
                  {t:'Fortalecimento 6: Circuito Completo', d:'4 exercícios: Agachamento, Flexão, Prancha, Afundo (1 min execução / 3 voltas / 1 min descanso).'},
                  {t:'Corrida 13: Simulação 5km (Quase lá!)', d:'5 min aquecimento + 25 minutos de corrida contínua em Z2/Z3 + 5 min volta à calma.'},
                  {t:'Corrida 14: Treino de Ajuste (2km)', d:'5 min aquecimento + 10 minutos de corrida em ritmo Z2 + 5 min volta à calma.'},
                  {t:'Corrida 15: Descanso Ativo (Caminhada)', d:'30 minutos de caminhada leve ou alongamento dinâmico.'},
                  {t:'Corrida 16: O Grande Dia: 5km!', d:'5 min aquecimento + Corrida Contínua de 5km em ritmo confortável (Z2).'}
                ];
                for(let i=0; i<tpls.length; i++){ const t=tpls[i]; const d=document.createElement('div'); d.style.cssText="background:#FFF; border:1px solid #EEE; padding:10px; border-radius:10px; display:flex; gap:10px; margin-bottom:10px;"; d.innerHTML=`<span style="font-weight:700; color:#AAA; font-size:12px; margin-top:5px;">${l.children.length+1}</span><div style="flex:1;"><input class="edt-t" value="${t.t}" style="width:100%; border:none; font-weight:700; font-size:12px; margin-bottom:5px; outline:none;"><input class="edt-d" value="${t.d}" style="width:100%; border:none; font-size:11px; color:#666; outline:none;"></div><button onclick="this.parentElement.remove()" style="color:var(--red); background:none; border:none; font-weight:bold;">X</button>`; l.appendChild(d); }
            }
        };
        document.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
